!function(){let t,e=GLOBAL_CONFIG.postHeadAiDescription.randomNum,i=GLOBAL_CONFIG.postHeadAiDescription.basicWordCount,n=GLOBAL_CONFIG.postHeadAiDescription.btnLink,o=GLOBAL_CONFIG.postHeadAiDescription.key,a=GLOBAL_CONFIG.postHeadAiDescription.Referer,l=GLOBAL_CONFIG.postHeadAiDescription.gptName,r=GLOBAL_CONFIG.postHeadAiDescription.switchBtn,s=-1,c=!0,d=GLOBAL_CONFIG.postHeadAiDescription.mode,m=0;const u=document.querySelector(".ai-title .anzhiyufont.anzhiyu-icon-arrow-rotate-right"),h=document.querySelector(".ai-explanation"),p=document.querySelector(".post-ai-description");let f="",y="",g=600,T=0,A=0,L=[],M=0;const I=t=>{if(c)if(I.start||(I.start=t),M=t-I.start,M>=20){if(I.start=t,T<y-1){let t=f.charAt(T+1),e=/[,.，。!?！？]/.test(t)?150:20;h.firstElementChild&&h.removeChild(h.firstElementChild),h.innerHTML+=t;let i=document.createElement("div");i.className="ai-cursor",h.appendChild(i),T++,150===e&&(document.querySelector(".ai-explanation .ai-cursor").style.opacity="0.2"),T===y-1&&(G.disconnect(),h.removeChild(h.firstElementChild)),L[0]=setTimeout((()=>{requestAnimationFrame(I)}),e)}}else requestAnimationFrame(I)},G=new IntersectionObserver((t=>{let e=t[0].isIntersecting;c=e,c&&(g=0===T?200:20,L[1]=setTimeout((()=>{A&&(T=0,A=0),0===T&&(h.innerHTML=f.charAt(0)),requestAnimationFrame(I)}),g))}),{threshold:0});function v(){L.length&&L.forEach((t=>{t&&clearTimeout(t)}))}function b(t,e=!0){T=0,A=1,v(),c=!1,M=0,G.disconnect(),h.innerHTML=e?"生成中. . .":"请等待. . .",f=t,y=f.length,G.observe(p)}async function E(t=i){if(T=0,A=1,v(),c=!1,M=0,G.disconnect(),"tianli"===d){t=Math.max(10,Math.min(2e3,t));const e={key:o,Referer:a},i=(postTitle+pageFillDescription).trim().substring(0,t),n={key:e.key,content:i,url:location.href},l={method:"POST",headers:{"Content-Type":"application/json",Referer:e.Referer},body:JSON.stringify(n)};try{let t,e=null;e&&clearInterval(e),e=setInterval((()=>{const t="生成中"+".".repeat(A);h.innerHTML=t,A=A%3+1}),500);const i=await fetch("https://summary.tianli0.top/",l);let n;n=403===i.status?{summary:"403 refer与key不匹配，本地无法显示。"}:500===i.status?{summary:"500 系统内部错误"}:await i.json(),t=n.summary.trim(),setTimeout((()=>{u.style.opacity="1"}),300),b(t||"摘要获取失败!!!请检查Tianli服务是否正常!!!"),clearInterval(e)}catch(t){console.error(t),h.innerHTML="发生异常"+t}}else{const t=pageAi.split(",").map((t=>t.trim()));if(1!==t.length){let e=Math.floor(Math.random()*t.length);for(;e===s;)e=Math.floor(Math.random()*t.length);s=e,b(t[e])}else b(t[0]);setTimeout((()=>{u.style.opacity="1"}),600)}}const O=document.querySelectorAll(".ai-btn-item");const k=[function(){b("tianli"==d?"我是文章辅助AI: TianliGPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。":`我是文章辅助AI: ${l} GPT，点击下方的按钮，让我生成本文简介、推荐相关文章等。`)},function(){u.click()},function(){T=0,A=1,v(),c=!1,M=0,h.innerHTML="生成中. . .",f="",y="",G.disconnect(),L[2]=setTimeout((()=>{h.innerHTML=function(){let t=document.querySelectorAll(".relatedPosts-list a");if(!t.length){const e=document.querySelector(".card-widget.card-recent-post");if(!e)return"";t=e.querySelectorAll(".aside-list-item a");let i="";for(let e=0;e<t.length;e++){const n=t[e];i+=`<div class="ai-recommend-item"><span class="index">${e+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${n.href}')" title="${n.title}" data-pjax-state="">${n.title}</a></div>`}return`很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br /><div class="ai-recommend">${i}</div>`}let e="";for(let i=0;i<t.length;i++){const n=t[i];e+=`<div class="ai-recommend-item"><span>推荐${i+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${n.href}')" title="${n.title}" data-pjax-state="">${n.title}</a></div>`}return`推荐文章：<br /><div class="ai-recommend">${e}</div>`}()}),600)},function(){b("正在前往博客主页...",!1),L[2]=setTimeout((()=>{pjax.loadUrl("/")}),1e3)}];function H(){document.querySelectorAll(".ai-btn-item").forEach((t=>{"go-tianli-blog"!==t.id&&(t.style.display="block"),"go-tianli-blog"===t.id&&(t.style.display="none")}))}O.forEach(((t,e)=>{t.addEventListener("click",(()=>{k[e]()}))})),document.getElementById("ai-tag").addEventListener("click",(()=>{"tianli"===d?(document.querySelectorAll(".ai-btn-item").forEach((t=>t.style.display="none")),document.getElementById("go-tianli-blog").style.display="block",b("你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，如果你也需要一个这样的AI摘要接口，可以在下方购买。（暂未开放购买，敬请期待）")):(document.getElementById("go-tianli-blog").style.display="none",b(`你好，我是本站摘要生成助理${l} GPT，是一个基于GPT-4的生成式AI。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。`))})),u.addEventListener("click",(()=>{const n=(postTitle+pageFillDescription).trim().substring(0,i);let o=Math.floor(Math.random()*e)+i;for(;o===t||n.length-o===t;)o=Math.floor(Math.random()*e)+i;if(u.style.opacity="0.2",u.style.transitionDuration="0.3s",u.style.transform="rotate("+360*m+"deg)",n.length<=i){let i=n.length-Math.floor(Math.random()*e);for(;i===t;)i=n.length-Math.floor(Math.random()*e);E(i),t=i}else E(o),t=o;H(),m++})),document.getElementById("go-tianli-blog").addEventListener("click",(()=>{window.open(n,"_blank")})),r&&document.getElementById("ai-Toggle").addEventListener("click",(()=>{!function(){if("tianli"===d)d="local",document.getElementById("ai-tag").innerHTML=`${l} GPT`,E(i);else{d="tianli",document.getElementById("ai-tag").innerHTML="Tianli GPT";const n=(postTitle+pageFillDescription).trim().substring(0,i);let o=Math.floor(Math.random()*e)+i;for(;o===t||n.length-o===t;)o=Math.floor(Math.random()*e)+i;if(u.style.opacity="0.2",u.style.transitionDuration="0.3s",u.style.transform="rotate("+360*m+"deg)",n.length<=1e3){let i=n.length-Math.floor(Math.random()*e);for(;i===t;)i=n.length-Math.floor(Math.random()*e);E(i),t=i}else E(o),t=o;m++}}()})),E(),H()}();